{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://intellidbgkit/contracts/plugin-manifest.schema.json",
  "title": "PluginManifest",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "name",
    "version",
    "provider",
    "type",
    "capabilities",
    "input_topics",
    "output_topics",
    "core_boundary",
    "healthcheck"
  ],
  "properties": {
    "name": {
      "type": "string",
      "pattern": "^[a-z0-9][a-z0-9_-]*$"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "provider": {
      "type": "string",
      "enum": [
        "tracezone",
        "uart",
        "gdb",
        "ebpf",
        "adb",
        "ssh",
        "telnet",
        "local",
        "gui",
        "wrapper",
        "mcp",
        "copilot-sdk"
      ]
    },
    "type": {
      "type": "string",
      "enum": [
        "collector",
        "analyzer",
        "actuator",
        "visual-adapter",
        "skill",
        "codec",
        "workflow-adapter"
      ]
    },
    "capabilities": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "string",
        "minLength": 1
      }
    },
    "capability_aliases": {
      "type": "object",
      "additionalProperties": {
        "type": "string",
        "minLength": 1
      }
    },
    "input_topics": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "output_topics": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "workflow_bindings": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "workflow_id",
          "step_id",
          "action"
        ],
        "properties": {
          "workflow_id": {
            "type": "string",
            "minLength": 1
          },
          "step_id": {
            "type": "string",
            "minLength": 1
          },
          "action": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    },
    "compatibility": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "min_core_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "max_core_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        }
      }
    },
    "core_boundary": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "allow_core_state_write",
        "allow_long_memory_write",
        "allowed_channels"
      ],
      "properties": {
        "allow_core_state_write": {
          "const": false
        },
        "allow_long_memory_write": {
          "const": false
        },
        "allowed_channels": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "enum": [
              "event_bus",
              "workflow_action",
              "evidence_input"
            ]
          }
        }
      }
    },
    "context_exchange": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "supports_session_handoff": {
          "type": "boolean"
        },
        "formats": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "json",
              "markdown",
              "evidence_refs"
            ]
          }
        }
      }
    },
    "healthcheck": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "type",
        "command",
        "timeout_ms"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "command",
            "rpc"
          ]
        },
        "command": {
          "type": "string",
          "minLength": 1
        },
        "timeout_ms": {
          "type": "integer",
          "minimum": 100
        }
      }
    }
  }
}
